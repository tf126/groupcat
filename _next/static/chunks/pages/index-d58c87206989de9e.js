(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(7042)}])},7042:function(e,n,l){"use strict";l.r(n),l.d(n,{default:function(){return R}});var r=l(5893),t=l(156),s=l(7754),a=l(7073),i=l(204),c=l(8911),o=l(1753),u=l(1708),d=l(8691),h=l(9222),p=l(651),x=l(8129),g=l(1163),j=l(7294),f=l(5772),v=l.n(f);let m=e=>{let{name:n}=e,l=(0,g.useRouter)(),r=(0,j.useMemo)(()=>l.query[n]?JSON.parse(v().decode(l.query[n])):null,[n,l.query]),t=(0,j.useCallback)(e=>{let{[n]:t,...s}=l.query;e instanceof Function?s[n]=v().encode(JSON.stringify(e(r))):null!==e&&(s[n]=v().encode(JSON.stringify(e))),l.push({query:{...s}},void 0,{shallow:!0}).catch(console.error)},[n,l,r]);return[r,t]};var k=l(2752),y=l(1963),C=l(4854),w=l(4504),b=l(5819),S=l(3793),O=l(7018);let E=e=>{let{isOpen:n,onClose:l}=e,[t,s]=m({name:"categories"}),[a,u]=(0,j.useState)([]),d=(0,j.useCallback)(e=>{let n=e.target.value.trim(),l=n.split("\n").filter(e=>e.length>0),r=new Map(l.map(e=>[e,1]));u(Array.from(r.keys()))},[]);return(0,j.useEffect)(()=>{u(null!=t?t:[])},[t,n]),(0,r.jsxs)(k.u_,{isOpen:n,onClose:l,size:"xl",children:[(0,r.jsx)(y.Z,{}),(0,r.jsxs)(C.h,{children:[(0,r.jsx)(w.x,{children:"Edit categories"}),(0,r.jsx)(b.o,{}),(0,r.jsx)(S.f,{children:(0,r.jsxs)(i.k,{direction:"column",gap:2,children:[(0,r.jsx)(o.g,{defaultValue:(null!=t?t:[]).join("\n"),onChange:d,h:"30vh"}),(0,r.jsx)(i.k,{w:"100%",justify:"center",children:(0,r.jsxs)(c.x,{children:["Detected ",a.length," unique categories"]})})]})}),(0,r.jsxs)(O.m,{children:[(0,r.jsx)(h.z,{colorScheme:"blue",mr:3,onClick:()=>{s(a),l()},children:"Save categories"}),(0,r.jsx)(h.z,{variant:"ghost",onClick:l,children:"Cancel"})]})]})]})};var M=l(7335),z=l(4371);let _=(e,n)=>(e%n+n)%n,I={levenshtein:z.X,lcs:(e,n)=>-function(e,n){let l=e.length,r=n.length,t=Array(r+1).fill(0);for(let s=1;s<=l;++s){let l=t[0];for(let a=1;a<=r;++a){let r=t[a];e[s-1]===n[a-1]?t[a]=1+l:t[a]=Math.max(t[a-1],t[a]),l=r}}return t[r]}(e,n)},q={levenshtein:"Levenshtein distance",lcs:"Longest common subsequence"},N={caseInsensitive:e=>e.toLowerCase(),alphaOnlyCaseInsensitive:e=>e.toLowerCase().replace(/[^a-z]/g,""),identity:e=>e},T={caseInsensitive:"Ignore case",alphaOnlyCaseInsensitive:"Ignore case and non-alphabetic characters",identity:"Exact match"},P=e=>e;function R(){let e=(0,j.useRef)(null),n=(0,j.useRef)(null),[l,g]=(0,j.useState)("caseInsensitive"),f=N[l],[v,k]=(0,j.useState)("lcs"),y=I[v],[C,w]=(0,j.useState)(!1),[b]=m({name:"categories"}),S=(0,j.useMemo)(()=>null!=b?b:[],[b]),O=(0,j.useMemo)(()=>new Map(S.map((e,n)=>[e,n])),[S]),z=(0,j.useCallback)(e=>{var n;let l=O.get(e);return void 0===l?null!==(n=S[0])&&void 0!==n?n:"":S[_(l+1,S.length)]},[S,O]),R=(0,j.useCallback)(e=>{var n;let l=O.get(e);return void 0===l?null!==(n=S[0])&&void 0!==n?n:"":S[_(l-1,S.length)]},[S,O]),A=(0,j.useMemo)(()=>S.map(e=>[e,(null!=f?f:P)(e)]),[S,f]),L=(0,j.useMemo)(()=>new Set(S),[S]),V=(0,j.useMemo)(()=>{let e=A.reduce((e,n)=>{var l;let[r,t]=n;return e[t]=(null!==(l=e[t])&&void 0!==l?l:0)+1,e},{}),n=new Set(Object.entries(e).filter(e=>{let[n,l]=e;return 1===l}).map(e=>{let[n,l]=e;return n})),l=A.filter(e=>{let[l,r]=e;return n.has(r)});return new Map(l.map(e=>{let[n,l]=e;return[l,n]}))},[A]),[X,J]=m({name:"data2catMap"}),[F,H]=(0,j.useState)({}),K=(0,j.useCallback)((e,n)=>{H(l=>({...l,[e]:n}))},[]),D=(0,j.useCallback)(e=>{if(X&&X.hasOwnProperty(e)){let n=X[e];if(L.has(n))return{type:"mapped",category:n}}let n=(null!=f?f:P)(e),l=V.get(n);if(l)return{type:"exact",category:l};let[r,t]=A.map(e=>{let[l,r]=e;return[l,y(n,r)]}).reduce((e,n)=>{let[l,r]=e,[t,s]=n;return s<r?[t,s]:[l,r]},[null,1/0]);return r?{type:"closest",category:r}:{type:"none",category:e}},[A,L,X,y,V,f]),[U,W]=(0,j.useState)({});(0,j.useEffect)(()=>{let e=G.reduce((e,n)=>(e[n]=D(n),e),{});W(e),H({})},[S,D]);let Y=(0,j.useCallback)(e=>{W(n=>({...n,[e]:D(e)}))},[D]),[Z,B]=(0,j.useState)([]),[G,Q]=(0,j.useState)([]),$=(0,j.useCallback)(e=>{let n=e.target.value,l=n.split("\n").map(e=>e.trim());B(l);let r=Array.from(new Set(l.filter(e=>e.length>0)));Q(r),r.forEach(e=>{U.hasOwnProperty(e)||Y(e)})},[Y,U]),ee=(0,j.useCallback)(()=>{J(e=>({...e,...F}))},[J,F]),en=(0,j.useCallback)(()=>{J(e=>{let n=G.filter(e=>e.length>0).reduce((e,n)=>{var l;return e[n]=null!==(l=F[n])&&void 0!==l?l:U[n].category,e},{});return{...e,...n}})},[U,J,G,F]),{onCopy:el,value:er,setValue:et,hasCopied:es}=(0,t.V)("");(0,j.useEffect)(()=>{var e;let n=Z.map(n=>""!==n?null!==(e=F[n])&&void 0!==e?e:U[n].category:"").join("\n");et(n)},[U,Z,et,F]);let{onCopy:ea,value:ei,setValue:ec,hasCopied:eo}=(0,t.V)("");(0,j.useEffect)(()=>{ec(window.location.href)});let{isOpen:eu,onOpen:ed,onClose:eh}=(0,M.q)();return(0,r.jsx)(s.M,{w:"100vw",h:"100vh",children:(0,r.jsxs)(a.K,{spacing:4,direction:"column",align:"center",w:"100%",maxW:"6xl",h:"90%",children:[(0,r.jsxs)(i.k,{gap:4,w:"100%",h:"80%",p:8,children:[(0,r.jsxs)(i.k,{direction:"column",flex:1,gap:2,children:[(0,r.jsx)(i.k,{justify:"center",children:(0,r.jsx)(c.x,{children:"Input"})}),(0,r.jsx)(o.g,{ref:e,onChange:$,h:"100%",flex:1,resize:"none",onScroll:()=>{var l;let r=n.current,t=null===(l=e.current)||void 0===l?void 0:l.scrollTop;t&&r&&(r.scrollTop=t)}})]}),(0,r.jsxs)(i.k,{direction:"column",flex:1.5,gap:2,children:[(0,r.jsx)(i.k,{justify:"center",children:(0,r.jsx)(c.x,{children:"Mappings Editor"})}),(0,r.jsx)(u.r,{p:4,border:"1px solid",borderColor:"whiteAlpha.200",borderRadius:"md",templateColumns:"2fr 1fr",gap:2,h:"min-content",maxH:"100%",overflowY:"scroll",children:G.map(e=>{var n;let{type:l,category:t}=U[e];return C&&("mapped"===l||"exact"===l)?null:(0,r.jsxs)(j.Fragment,{children:[(0,r.jsx)(i.k,{align:"center",children:(0,r.jsx)(c.x,{fontSize:"xs",children:e})}),(0,r.jsx)(d.P,{size:"xs",bg:F[e]?"rgba(214, 188, 250, 0.32)":function(e){switch(e){case"exact":return"rgba(56, 161, 105, 0.32)";case"mapped":return"rgba(154, 230, 180, 0.32)";case"closest":return"rgb(251, 211, 141, 0.32)";case"none":return"rgba(254, 178, 178, 0.32)"}}(l),onChange:n=>K(e,n.target.value),value:null!==(n=F[e])&&void 0!==n?n:t,onKeyUp:n=>{"ArrowLeft"===n.key&&K(e,R(n.currentTarget.value)),"ArrowRight"===n.key&&K(e,z(n.currentTarget.value))},children:S.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]},e)})})]}),(0,r.jsxs)(i.k,{direction:"column",flex:1,gap:2,children:[(0,r.jsx)(i.k,{justify:"center",children:(0,r.jsx)(c.x,{children:"Output"})}),(0,r.jsx)(o.g,{ref:n,value:er,h:"100%",flex:1,isReadOnly:!0,resize:"none",onScroll:()=>{var l;let r=e.current,t=null===(l=n.current)||void 0===l?void 0:l.scrollTop;t&&r&&(r.scrollTop=t)}})]})]}),(0,r.jsxs)(i.k,{gap:2,children:[(0,r.jsx)(h.z,{onClick:ed,children:"Edit categories"}),(0,r.jsx)(h.z,{onClick:ee,children:"Save modified only"}),(0,r.jsx)(h.z,{onClick:en,children:"Save all mapping"}),(0,r.jsx)(p.X,{onChange:()=>w(e=>!e),isChecked:C,children:"Hide known mappings"}),(0,r.jsx)(h.z,{onClick:el,children:es?"Copied!":"Copy output"})]}),(0,r.jsxs)(i.k,{align:"center",gap:"8",children:[(0,r.jsxs)(i.k,{align:"center",children:[(0,r.jsx)(c.x,{children:"Match type: "}),(0,r.jsx)(d.P,{onChange:e=>g(e.target.value),children:Object.entries(T).map(e=>{let[n,l]=e;return(0,r.jsx)("option",{value:n,children:l},n)})})]}),(0,r.jsxs)(i.k,{align:"center",children:[(0,r.jsx)(c.x,{children:"Similarity measure: "}),(0,r.jsx)(d.P,{onChange:e=>k(e.target.value),children:Object.entries(q).map(e=>{let[n,l]=e;return(0,r.jsx)("option",{value:n,children:l},n)})})]})]}),(0,r.jsxs)(i.k,{align:"center",gap:"2",pt:"8",px:"8",w:"100%",children:[(0,r.jsx)(c.x,{children:"Share categories and mappings: "}),(0,r.jsx)(x.I,{value:ei,isReadOnly:!0}),(0,r.jsx)(h.z,{onClick:ea,children:eo?"Copied!":"Copy"})]}),(0,r.jsx)(E,{isOpen:eu,onClose:eh})]})})}}},function(e){e.O(0,[376,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);